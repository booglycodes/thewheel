<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wheel</title>
    <style>
        h1 {
            padding-left: 20px;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            touch-action: manipulation;
        }

        textarea {
            font-size: 16px;
            border-radius: 8px;
            /* Rounded corners */
            border: 1px solid #ddd;
            /* Light border */
            background-color: #fff;
            /* White background */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* Add a slight shadow */
            resize: none;
            /* Prevent resizing */
            width: max-content;
            margin-left: 10px;
            margin-top: 10px;
        }

        /* Basic button styling */
        button {
            background-color: #d3d3d3;
            /* Light grey background */
            color: #000000;
            /* Black text */
            border: 1px solid #000000;
            /* Black border */
            padding: 10px 15px;
            /* Padding for better appearance */
            font-size: 16px;
            /* Font size */
            font-family: Arial, sans-serif;
            /* Font family */
            text-align: center;
            /* Center text */
            cursor: pointer;
            /* Pointer cursor on hover */
            border-radius: 4px;
            /* Rounded corners */
            transition: background-color 0.3s ease;
            /* Smooth color transition */
        }

        /* Button hover effect */
        .button:hover {
            background-color: #f1f1f1;
        }

        .selected-button {
            background-color: #5f8094;
        }

        @media (max-width: 400px) {
            .lower-button {
                margin-right: 100px;
            }
        }

        /* Universal select styling */
        select {
            background-color: #e0e0e0; /* Light grey background */
            color: #333; /* Dark text color for contrast */
            padding: 8px 12px; /* Adjust padding to fit text better */
            border: 1px solid #000000; /* Grey border */
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            outline: none;
            position: relative;
            width: auto; /* Allow width to adjust based on content */
        }
    </style>
    </style>
</head>

<body>
    <h1>Wheel
        <a onclick="undo()">
            <svg fill="#000000" width="30px" height="30px" viewBox="0 0 32 32" id="Layer_1" data-name="Layer 1"
                xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <style>
                        .cls-1 {
                            fill: none;
                        }
                    </style>
                </defs>
                <path
                    d="M20,10H7.8149l3.5874-3.5859L10,5,4,11,10,17l1.4023-1.4146L7.8179,12H20a6,6,0,0,1,0,12H12v2h8a8,8,0,0,0,0-16Z" />
                <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32"
                    height="32" />
            </svg><a style="font-size: small; vertical-align: middle; padding-bottom: 10px;">undo</a>
        </a>
    </h1>

    <script language='JavaScript' type='text/javascript'
        src='https://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js'></script>
    <script>
        const OAUTH_URL = 'https://www.googleapis.com/oauth2/v4/token'
        const GOOGLE_SHEETS_SCOPE = 'https://www.googleapis.com/auth/spreadsheets'
        const GOOGLE_SHEETS_URL = 'https://sheets.googleapis.com/v4/spreadsheets/{0}/values/Sheet1!{1}?{2}'
        const WHEEL_SHEETS_ID = '1ray4gflepLQH7RRHBEcuRZEIv7GfNlkQmqLbiCvCanA'
        const SERVICE_ACCOUNT = {
            'type': 'service_account',
            'project_id': 'wheel-431014',
            'private_key_id': '338665c2d750' + 'e1c4fe' +
                '9d8475e2af962b593c7744',
            'private_key': '-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAg' +
                'EAAoIBAQCkTta0oWaWwtY+\nHTQEpvs5JJILd/rqR6w6+ByK6F2E/rjOPv3fv5Lr+hM1ThMNv/iIkK2BQWjXI5ut\n' +
                'RtoL0X2zCnkaC4z3hgRN86fnbNzCLx0Y94k6S3ykMzVCQhdCWC3mqq8zc9rH7/4v\nETkMkvvAQ72cc8+hXnvW19cD8feIvGLLtarmRME52NJlFKQHpYKjnRuKU2oowxSQ\nAVXC3z6etmWbGdxXAJbYZ9bxKa22P7kavd5tNvxJxQf1U6VjksWheHXrx+d2Cg5J\nl7p5Q8i2VSqg3wdtKNcVe/EwBGT1gCSLN6kOgnQ1mZP+I75KoCThfDn2uaYwRYHT\nqcSOE/SdAgMBAAECggEACAcOVfPn6ky76jLWD7Yghw5CkK+YCoWCW09888uVPGa0\nHObx9/bJFOpDjLKqCO+6XAbgZGJ9XrvGbABX0nK11tYFXs5RhXj1Y+FPAtPnsz1Z\nUmAGQv+mJ/NLrcT53Tlw94ZRvpWV+JxTLho60BmHuoo93xya09a3RuvztADbDIri\n+E0A8JaWAN3tuuio/dNm0UPAltBJSF7nTxoQTSUi6ne/34qIIrQc6dN5onjerRDU\nmuLpq9q5DzsXTD8fD78vnuDtX3x2e6w2r9bL4Zm0sBj5ICAh/hkC1R/FJh6ahvEn\n+LgNg4SDt0uCqk/A6S2bo1cgdLePoPSMUmRQqo4SBwKBgQDkqg5Umbx0aaNY/bg5\nC0no0+5TpTgjoDlhcvP9aqqjcMCvKzWKjmIsvSwITTGi7kzWXIjwjGyeKwyW0sLs\nz4KNsyvYJZwg5u4WRvXKFRlg5RypFGTyx6vIF9h0knse4ls0iNQVSTJD8gq5jXQc\n/IC78iLyD2p6nrhMVAVaIlcevwKBgQC38z/cN3Oelb8nqQntUd0IB1c73wdcHQ5s\nJPdTfC1n15ZTYdEH/3UR7hwXoRoJ0LtFcvKlAOTWrftqmncZsjPY/RYnm0XZG8Hf\n04xJ6sB5kiSb2FGvIohpXZEfKRhC8/ilOuhBe7iWQIBysDnGVvkWc5//VkChnEMu\nFE08Ku3fowKBgQCRUSVUTHNAhBXkKzHVRsBMr8qo67nWoi91J6m5Zf1VawV5DPu0\ntzHa/smp6Ozff5PjMuFwBb3NcsxIWV65QlLUnIYDkjs7iabLD4OKTohXVKM3LJfO\n1mfr/IN56dFG2lFd/IrTkDXaikqYizW8aheh2YqtzHA9xvqWv1q7YlF9XwKBgGry\ns0M+visKlzvgzNO8z8x2MCKwFeBZSGRZza4tOVzxfAX4jgafYJpPHOgkEzZ3tBm5\nrhd/AI1MVCtzqSE4eWqEItheL2r992dB4IOtR8Cm1kABseQoKLVR4CkExIVQwVSX\nfidsXjKFR+jmSoDlWibSjMhwhl0vs+NbjFgaAXkPAoGARpieI8L/C49oO5PdKYlo\nsty9kg1+jxnsy46ToabmTxwaVh5iI6JJY2ePtCAr9VY8EWuQyl75dSYsGuHsztAE\nELUUP3i8g8DHyD063B7HzWvt5KXajeDGu95NEScZ6R6jATLNcDuNnY2llWq9lxB5\nW5H1ANiuKjCQrzgS8IS7Wns=\n-----END PRIVATE KEY-----\n',
            'client_email': 'wheelacc@wheel-431014.iam.gserviceaccount.com',
            'client_id': '114172704513' + '412960649',
            'auth_uri': 'https://accounts.google.com/o/oauth2/auth',
            'token_uri': 'https://oauth2.googleapis.com/token',
            'auth_provider_x509_cert_url': 'https://www.googleapis.com/oauth2/v1/certs',
            'client_x509_cert_url': 'https://www.googleapis.com/robot/v1/metadata/x509/wheelacc%40wheel-431014.iam.gserviceaccount.com',
            'universe_domain': 'googleapis.com'
        }

        if (!String.prototype.format) {
            String.prototype.format = function () {
                var args = arguments
                return this.replace(/{(\d+)}/g, function (match, number) {
                    return typeof args[number] != 'undefined'
                        ? args[number]
                        : match
                })
            }
        }

        let wheel_history = []
        let spin_counter = {}
        let current_spin = ''
        let names_of_wheels
        let authToken
        let state
        let filter_state = ''
        async function start() {
            authToken = await fetchAuthToken()
            let [wheels, wheel_names] = await getWheels(authToken)
            names_of_wheels = wheel_names
            let btns = []
            state = 'spin'
            for (let btn of [['add', add], ['spin', spins], ['remove', remove], ['random', rand]]) {
                let button = document.createElement('button')
                button.id = btn[0]
                button.textContent = btn[0]
                button.style.marginLeft = '10px'
                button.style.fontSize = '16px'
                button.style.cursor = 'pointer'
                button.className = 'button'
                document.body.appendChild(button);
                btns.push(button)
                button.addEventListener('click', function () {
                    for (let btn of btns) {
                        btn.className = 'button'
                        btn.style.boxShadow = 'none'
                        btn.style.marginLeft = '10px'
                    }
                    this.className = 'selected-button'
                    this.style.marginLeft = '10px'

                    this.style.boxShadow = '0 0 0 5px rgba(1.0, 0, 0, 0.3)'
                    cleanslate()
                    btn[1](wheels, wheel_names, authToken)
                    state = btn[0]
                })
            }
            btns[1].className = 'selected-button'
            btns[1].style.boxShadow = '0 0 0 5px rgba(1.0, 0, 0, 0.3)'
            let wheel_dropdown_container = document.createElement('div')
            let wheel_dropdown = document.createElement('select')
            wheel_dropdown.style.marginTop = '15px'
            wheel_dropdown.style.marginLeft = '10px'
            wheel_dropdown.style.fontSize = '16px'
            wheel_dropdown.id = 'wheel-dropdown'
            for (let wheel_name of wheel_names) {
                let option = document.createElement('option')
                option.value = wheel_name
                option.innerText = wheel_name
                wheel_dropdown.appendChild(option)
            }
            wheel_dropdown.value = 'bigly'
            wheel_dropdown_container.appendChild(wheel_dropdown)
            document.body.appendChild(wheel_dropdown_container)
            spins(wheels, wheel_names)
        }

        function undo() {
            if (wheel_history.length === 0) {
                throw new Error('cannot undo further')
            }
            let wheels = wheel_history.pop()
            writeSheet(wheels_to_data(wheels, names_of_wheels), authToken)
            alert('undo successful')
            cleanslate()
            if (state === 'remove') {
                remove(wheels, names_of_wheels, authToken)
            } else if (state === 'spin') {
                spins(wheels, names_of_wheels, authToken)
            } else if (state === 'add') {
                add(wheels, names_of_wheels, authToken)
            }
        }

        function cleanslate() {
            document.getElementById('wheel-dropdown').style.display = ''
            document.getElementById('container').remove()
        }

        // see https://stackoverflow.com/questions/28751995/how-to-obtain-google-service-account-access-token-javascript
        async function fetchAuthToken() {
            let header = {
                'alg': 'RS256',
                'typ': 'JWT'
            }
            let claim = {
                aud: OAUTH_URL,
                scope: 'https://www.googleapis.com/auth/spreadsheets',
                iss: SERVICE_ACCOUNT.client_email,
                exp: KJUR.jws.IntDate.get('now + 1hour'),
                iat: KJUR.jws.IntDate.get('now')
            }
            let jws = KJUR.jws.JWS.sign(null, JSON.stringify(header), JSON.stringify(claim), SERVICE_ACCOUNT.private_key)
            let response = await fetch(OAUTH_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
                    assertion: jws
                })
            })
            let responseData = await response.json()
            return responseData.access_token
        }

        async function readSheet(range, authToken, queryParams) {
            let response = await fetch(GOOGLE_SHEETS_URL.format(WHEEL_SHEETS_ID, range, queryParams), {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + authToken,
                    'Content-Type': 'application/json'
                }
            })
            return await response.json()
        }

        async function writeSheet(data, authToken) {
            console.log(data)
            let response = await fetch(GOOGLE_SHEETS_URL.format(WHEEL_SHEETS_ID, 'A1', 'valueInputOption=RAW'), {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + authToken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    range: 'Sheet1!A1',
                    majorDimension: 'COLUMNS',
                    values: data
                })
            })
            return await response.json()
        }

        async function getWheels(authToken) {
            // first, read headers, that tells us the names of the wheels and how many elements are in each wheel
            let headers = await readSheet('A1:C2', authToken, 'majorDimension=ROWS')
            let wheel_names = headers.values[0]
            let counts = headers.values[1].map((val, _) => parseInt(val))
            let table
            if (Math.max(...counts) == 0) {
                // if counts are all zero, the range in readSheet below won't be correct. 
                // instead, just populate empty for all wheels.
                table = { values: headers.values[0].map((_, __) => []) }
            } else {
                // then, read the table
                table = await readSheet('A3:C' + (Math.max(...counts) + 2), authToken, 'majorDimension=COLUMNS')
            }
            console.log(table)
            let wheels = {}
            for (let i = 0; i < wheel_names.length; i++) {
                wheels[wheel_names[i]] = []
                for (let j = 0; j < counts[i]; j++) {
                    wheels[wheel_names[i]].push(table.values[i][j])
                }
            }
            console.log(wheels)
            return [wheels, wheel_names]
        }

        function spins(wheels, wheel_names) {
            let container = document.createElement('div')
            container.id = 'container'
            document.body.appendChild(container)

            let numSpins = document.createElement('div')
            numSpins.style.marginTop = '10px'
            numSpins.style.marginLeft = '10px'
            numSpins.style.marginBottom = '10px'

            for (let wheel_name of wheel_names) {
                if (spin_counter[wheel_name] === undefined) {
                    spin_counter[wheel_name] = 0
                }
            }

            let button = document.createElement('button')
            button.id = 'spin';
            button.textContent = 'jamble!'
            button.style.marginLeft = '10px'
            button.style.marginTop = '10px'
            button.style.marginBottom = '0px'
            button.style.fontSize = '12px'
            button.style.cursor = 'pointer'
            button.className = 'button lower-button'
            container.appendChild(button)
            button.addEventListener('click', function () {
                let wheel = document.getElementById('wheel-dropdown').value
                if (wheels[wheel].length === 0) {
                    output.innerText = 'no tasks in this wheel'
                    return
                }
                let randomNumber = Math.floor(Math.random() * wheels[wheel].length)
                current_spin = wheels[wheel][randomNumber]
                output.innerText = current_spin
                spin_counter[wheel] += 1
                numSpins.textContent = 'Spins: ' + JSON.stringify(spin_counter)
            })

            numSpins.textContent = 'Spins: ' + JSON.stringify(spin_counter)
            container.appendChild(numSpins)

            let output = document.createElement('div')
            output.id = 'output'
            output.style.margin = '10px'
            output.style.fontSize = '1.5em'
            output.innerText = current_spin
            container.appendChild(output)
        }

        function add(wheels, wheel_names, authToken) {
            let container = document.createElement('div')
            container.id = 'container'
            document.body.appendChild(container)
            let div = document.createElement('div')
            container.appendChild(div)
            let textbox = document.createElement('textarea')
            textbox.id = 'textbox'
            textbox.type = 'text'
            textbox.placeholder = 'Enter spin here'
            if (window.innerWidth > 1000) {
                textbox.rows = 20
                textbox.cols = 100
            } else {
                textbox.rows = 5
                textbox.cols = 30
            }
            div.appendChild(textbox);

            let button = document.createElement('button')
            button.id = 'add'
            button.textContent = 'add'
            button.style.marginLeft = '10px'
            button.style.marginTop = '10px'
            button.style.marginBottom = '0px'
            button.style.fontSize = '12px'
            button.style.cursor = 'pointer'
            button.className = 'button lower-button'
            container.appendChild(button)
            button.addEventListener('click', function () {
                if (textbox.value == '') {
                    throw Error('task description is empty')
                }
                wheel_history.push(JSON.parse(JSON.stringify(wheels)))
                let wheel = document.getElementById('wheel-dropdown').value
                wheels[wheel].push(textbox.value)
                writeSheet(wheels_to_data(wheels, wheel_names), authToken)
                textbox.value = ''
            })
        }

        function wheels_to_data(wheels, wheel_names) {
            let data = []
            for (let x = 0; x < wheel_names.length; x++) {
                let col = []
                col.push(wheel_names[x])
                col.push(wheels[wheel_names[x]].length + '')
                for (let y = 0; y < wheels[wheel_names[x]].length; y++) {
                    col.push(wheels[wheel_names[x]][y])
                }
                console.log(col)
                data.push(col)
            }
            return data
        }

        function remove(wheels, wheel_names, authToken) {
            let container = document.createElement('div')
            container.id = 'container'
            document.body.appendChild(container)
            document.getElementById('wheel-dropdown').style.display = 'none'

            let search = document.createElement('input')
            search.type = 'text';
            search.placeholder = 'filter...';
            search.style.marginLeft = '10px'
            search.style.fontSize = '18px'
            search.style.marginTop = '15px'
            search.value = filter_state
            container.appendChild(search)

            search.addEventListener('keyup', function () {
                document.getElementById('spins-container').remove()
                filter_state = search.value
                generate_entries(container, wheels, wheel_names, authToken, filter_state)
            })
            generate_entries(container, wheels, wheel_names, authToken, filter_state)
        }

        function generate_entries(container, wheels, wheel_names, authToken, filter) {
            let spins = document.createElement('div')
            spins.id = 'spins-container'
            container.appendChild(spins)

            let tasks_to_remove = {}
            for (let i = 0; i < wheel_names.length; i++) {
                tasks_to_remove[wheel_names[i]] = []
                let title = document.createElement('h1')
                title.innerText = wheel_names[i]
                title.style.display = 'inline-block'
                title.style.marginRight = '5px'
                title.style.marginBottom = '1vh'
                spins.appendChild(title)

                let count = document.createElement('p')
                count.style.display = 'inline'
                spins.appendChild(count)
                let x = 0
                for (let j = 0; j < wheels[wheel_names[i]].length; j++) {
                    if (filter !== '') {
                        if (!wheels[wheel_names[i]][j].toUpperCase().includes(filter.toUpperCase())) {
                            continue;
                        }
                    }

                    let entry = document.createElement('div')
                    let dark = x % 2 === 0
                    if (dark) {
                        entry.style.background = 'darkgrey'
                    } else {
                        entry.style.background = 'lightgrey'
                    }
                    x++

                    entry.style.maxWidth = '1200px'
                    entry.style.verticalAlign = 'middle'
                    entry.style.alignItems = 'center'
                    entry.style.display = 'flex'
                    entry.style.height = 'auto'
                    spins.appendChild(entry)

                    let task = document.createElement('div')
                    task.style.fontSize = '16px'
                    task.style.marginRight = '30px'
                    
                    if (filter !== '') {
                        let text = wheels[wheel_names[i]][j]
                        let highlighted_text = text.replaceAll(new RegExp(filter, 'gi'), match => '<span style="background-color: yellow;">' + match + '</span>')
                        task.innerHTML = highlighted_text
                    } else {
                        task.innerText = wheels[wheel_names[i]][j]
                    }
                    
                    task.style.display = 'inline-block'
                    task.style.width = 'auto'
                    task.style.wordWrap = 'break-word'
                    task.style.whiteSpace = 'normal'
                    task.style.marginBottom = '10px'
                    task.style.marginTop = '10px'
                    task.style.marginLeft = '5px'
                    task.style.cursor = 'default'
                    task.className = 'noselect'
                    entry.appendChild(task)

                    let selected = false
                    entry.addEventListener('click', function () {
                        console.log(entry.style.background)
                        if (!selected) {
                            selected = true
                            if (dark) {
                                entry.style.background = '#F07971'
                            } else {
                                entry.style.background = '#FAA0A0'
                            }
                            tasks_to_remove[wheel_names[i]].push(j)
                        } else {
                            selected = false
                            if (dark) {
                                entry.style.background = 'darkgrey'
                            } else {
                                entry.style.background = 'lightgrey'
                            }
                            removeItem(tasks_to_remove[wheel_names[i]], j)
                        }
                    })
                }
                if (x === 0) {
                    title.remove()
                    count.remove()
                } else {
                    count.innerText = '(' + x + ')'
                }
            }

            let button = document.createElement('button')
            button.textContent = 'remove selected'
            button.style.marginLeft = '50px'
            button.style.marginTop = '20px'
            button.style.marginBottom = '200px'
            button.style.fontSize = '16px'
            button.style.cursor = 'pointer'
            button.className = 'button'
            spins.appendChild(button)
            button.addEventListener('click', function () {
                wheel_history.push(JSON.parse(JSON.stringify(wheels)))
                for (let i = 0; i < wheel_names.length; i++) {
                    new_wheel = []
                    for (let j = 0; j < wheels[wheel_names[i]].length; j++) {
                        if (!tasks_to_remove[wheel_names[i]].includes(j)) {
                            new_wheel.push(wheels[wheel_names[i]][j])
                        }
                    }
                    wheels[wheel_names[i]] = new_wheel
                }
                writeSheet(wheels_to_data(wheels, wheel_names), authToken)
                document.getElementById('spins-container').remove()
                generate_entries(container, wheels, wheel_names, authToken, filter)
            })
        }

        function removeItem(arr, value) {
            var index = arr.indexOf(value)
            if (index > -1) {
                arr.splice(index, 1)
            }
            return arr
        }

        function opt(name) {
            let opt = document.createElement('option')
            opt.value = name
            opt.innerText = name
            return opt
        }

        function rand() {
            let container = document.createElement('div')
            container.id = 'container'
            document.body.appendChild(container)
            document.getElementById('wheel-dropdown').style.display = 'none'

            let rand_dropdown = document.createElement('select')
            rand_dropdown.style.marginTop = '15px'
            rand_dropdown.style.marginLeft = '10px'
            rand_dropdown.style.fontSize = '16px'
            rand_dropdown.id = 'rand-dropdown'
            rand_dropdown.appendChild(opt('random-ordering'))
            rand_dropdown.appendChild(opt('random-number'))
            rand_dropdown.appendChild(opt('coinflip'))
            container.appendChild(rand_dropdown)

            let numinput = document.createElement('input')
            numinput.type = 'number'
            numinput.value = '3'
            numinput.style.marginTop = '15px'
            numinput.style.marginLeft = '10px'
            numinput.style.fontSize = '16px'
            numinput.addEventListener('keyup', function () {
                numinput.value = numinput.value.replace(/[^0-9]/g, '');
            })
            container.appendChild(numinput)

            let button = document.createElement('button')
            button.textContent = 'go!'
            button.style.marginLeft = '50px'
            button.style.marginTop = '20px'
            button.style.fontSize = '16px'
            button.style.cursor = 'pointer'
            button.className = 'button'
            container.appendChild(button)

            let output = document.createElement('div')
            button.addEventListener('click', function () {
                if (rand_dropdown.value == 'coinflip') {
                    alert(Math.random() < 0.5 ? 'Heads' : 'Tails')
                }
                if (rand_dropdown.value == 'random-ordering') {
                    alert(getRandomOrdering(parseInt(numinput.value)))
                }
                if (rand_dropdown.value == 'random-number') {
                    alert(getRandomNumber(1, parseInt(numinput.value)))
                }
            })
        }

        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomOrdering(n) {
            // Create an array of numbers from 1 to n
            let arr = Array.from({ length: n }, (_, i) => i + 1);

            // Shuffle the array using the Fisher-Yates algorithm
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]]; // Swap elements
            }

            return arr;
        }

        function findAllMatches(string, substring) {
            let lowerString = string.toLowerCase()
            let lowerSubstring = substring.toLowerCase()
            let positions = []
            let position = lowerString.indexOf(lowerSubstring)

            while (position !== -1) {
                positions.push(position)
                position = lowerString.indexOf(lowerSubstring, position + 1)
                console.log('stuck')
            }
            return positions
        }

        // alert on all errors
        window.addEventListener('error', (e) => alert(e.message))
        start()
    </script>
</body>

</html>